# Pitfalls Research

**Domain:** Одностраничный свадебный сайт-приглашение
**Researched:** 2026-02-22
**Confidence:** HIGH

## Critical Pitfalls

### Pitfall 1: Тяжёлые изображения убивают загрузку на мобильных

**Что идёт не так:**
Неоптимизированные фотографии (3-10 МБ каждая) приводят к времени загрузки 10+ секунд на мобильном 4G. Гости закрывают страницу, не дождавшись.

**Почему это происходит:**
Разработчики загружают оригинальные фото с камеры/телефона без сжатия. JPEG 4000x3000 весит 5-8 МБ.

**Как избежать:**
- Использовать `next/image` с автоматической оптимизацией (WebP/AVIF)
- Задать `sizes` для responsive изображений
- Blur placeholder для мгновенной загрузки скелета
- Lazy loading для изображений ниже fold
- Ограничить исходные фото до 1920px по ширине
- При `output: 'export'` — предварительно оптимизировать через sharp

**Предупреждающие знаки:**
- Lighthouse Performance < 70
- LCP > 4 секунд
- Суммарный размер страницы > 5 МБ

**Фаза для устранения:** Phase 1 (фундамент — настройка next/image и оптимизация)

---

### Pitfall 2: Карта не загружается или блокируется

**Что идёт не так:**
Google Maps требует API-ключ и биллинг. Яндекс.Карты могут не работать за пределами РФ. Карта не рендерится или показывает ошибку.

**Почему это происходит:**
- Google Maps API требует привязки карты — бесплатный лимит 28k загрузок/мес, но нужен billing account
- Яндекс.Карты JavaScript API требует API-ключ
- Iframe embed может блокироваться Content Security Policy

**Как избежать:**
- Использовать Яндекс.Карты iframe embed (конструктор карт) — не требует API-ключа
- Подготовить статичное изображение карты как fallback
- Ленивая загрузка iframe — загружать только при скролле к секции
- Тестировать на мобильных устройствах (iOS Safari, Android Chrome)

**Предупреждающие знаки:**
- Пустое место вместо карты
- Ошибки в консоли: `RefererNotAllowedMapError`, CSP violations
- Карта работает локально, но не на продакшн

**Фаза для устранения:** Phase 3 (интерактивные компоненты — карта)

---

### Pitfall 3: RSVP форма ломается в день свадьбы

**Что идёт не так:**
Бесплатные тарифы EmailJS (200 писем/мес), Formspree (50 submissions/мес), Google Sheets API (лимиты запросов) — все могут исчерпаться при массовой рассылке гостям.

**Почему это происходит:**
100+ гостей получают ссылку одновременно в WhatsApp/Telegram, все заходят в течение 1-2 часов, исчерпывают лимиты.

**Как избежать:**
- Проверить лимиты выбранного сервиса заранее
- EmailJS: 200 писем/мес бесплатно — достаточно для ~100 гостей с запасом
- Formspree: только 50/мес на бесплатном — НЕ подходит для большой свадьбы
- Google Sheets API: 300 запросов/мин — обычно достаточно
- Реализовать обработку ошибок в форме — показать "Спасибо, мы получим ваш ответ" даже при ошибке
- Хранить ответы локально (localStorage) как backup

**Предупреждающие знаки:**
- Тестовые отправки возвращают 429 (rate limit)
- Письма приходят с задержкой
- Гости сообщают "форма не работает"

**Фаза для устранения:** Phase 4 (RSVP форма и интеграции)

---

### Pitfall 4: Анимации тормозят на слабых устройствах

**Что идёт не так:**
Framer Motion анимации на каждой секции → janky scroll на старых Android (Samsung Galaxy A-серии, Xiaomi Redmi). FPS падает ниже 30.

**Почему это происходит:**
- Анимация `height`, `width`, `margin` вызывает layout recalculation
- Слишком много одновременных анимаций при скролле
- Отсутствие `will-change` hint для GPU-ускорения

**Как избежать:**
- Анимировать ТОЛЬКО `transform` и `opacity` — они GPU-ускорены
- Использовать `whileInView` с `once: true` — анимация только один раз
- Добавить `@media (prefers-reduced-motion: reduce)` — отключить анимации для тех, кто их отключил в системе
- Ограничить количество одновременных анимаций (stagger)
- Тестировать на реальном бюджетном Android-телефоне

**Предупреждающие знаки:**
- Рывки при прокрутке
- CPU usage > 60% при скролле (Chrome DevTools)
- Анимации "дёргаются" вместо плавного движения

**Фаза для устранения:** Phase 2 (визуальные компоненты — анимации)

---

### Pitfall 5: OG-теги не работают в Telegram/WhatsApp

**Что идёт не так:**
При отправке ссылки в мессенджер не отображается красивая карточка с фото и заголовком. Вместо этого — голая ссылка или неправильное изображение.

**Почему это происходит:**
- Telegram/WhatsApp кешируют OG-теги агрессивно
- Мессенджеры не исполняют JavaScript — нужны статические meta-теги
- Неправильный размер OG-изображения (нужно 1200x630)
- Отсутствие `og:image:width` и `og:image:height`

**Как избежать:**
- Использовать Next.js `metadata` API (статически генерируется)
- OG-изображение: строго 1200x630px, JPEG, < 1 МБ
- Указать `og:image:width`, `og:image:height`, `og:image:type`
- Тестировать через @WebpageBot в Telegram
- Для обновления кеша: добавить `?v=2` к URL изображения

**Предупреждающие знаки:**
- Отправляете ссылку в Telegram — нет превью
- Превью показывает старое/не то изображение
- На десктопе работает, в мессенджере — нет

**Фаза для устранения:** Phase 5 (SEO, OG-теги, финальная полировка)

---

### Pitfall 6: Шрифты не загружаются / FOUT (Flash of Unstyled Text)

**Что идёт не так:**
При загрузке страницы текст мелькает системным шрифтом, затем резко меняется на кастомный. Или кастомный шрифт вообще не загружается, и текст выглядит «дёшево».

**Почему это происходит:**
- Загрузка шрифтов с Google Fonts как внешний ресурс (блокирующий)
- Нет `font-display: swap`
- Не используется `next/font` для self-hosting

**Как избежать:**
- Использовать `next/font/google` — self-hosted, без external requests
- Или `next/font/local` для кастомных шрифтов
- `font-display: swap` включён по умолчанию в `next/font`
- Выбрать fallback шрифт, близкий по метрикам

**Предупреждающие знаки:**
- Мерцание текста при загрузке
- CLS (Cumulative Layout Shift) > 0.1
- Текст "прыгает" по высоте при загрузке шрифта

**Фаза для устранения:** Phase 1 (фундамент — настройка шрифтов)

---

### Pitfall 7: Обратный отсчёт показывает неправильное время

**Что идёт не так:**
Таймер показывает "2 дня 5 часов" гостю в Москве и "2 дня 8 часов" гостю в Новосибирске. Или вообще уходит в минус после свадьбы.

**Почему это происходит:**
- `new Date()` использует локальную timezone браузера гостя
- Дата свадьбы задана без timezone: `new Date('2026-09-15')` — интерпретируется по-разному
- Серверное время может отличаться от клиентского (hydration mismatch)

**Как избежать:**
- Указать точное время с timezone: `new Date('2026-09-15T15:00:00+03:00')`
- Вычислять оставшееся время на клиенте (`'use client'`)
- Подавить hydration mismatch: рендерить placeholder на сервере, реальный таймер на клиенте
- Показать текст «Свадьба состоялась!» когда таймер уходит в 0

**Предупреждающие знаки:**
- React hydration warning в консоли
- Таймер "прыгает" на 1-3 секунды при загрузке
- Разные значения у разных гостей

**Фаза для устранения:** Phase 2 (динамические компоненты — таймер)

---

## Technical Debt Patterns

| Shortcut | Immediate Benefit | Long-term Cost | When Acceptable |
|----------|-------------------|----------------|-----------------|
| Хардкод данных в компонентах | Быстрая разработка | Тяжело обновлять | Никогда — используй `constants.ts` |
| Inline стили вместо Tailwind | Быстрый прототип | Несогласованность, дублирование | Только для единичных уникальных значений |
| `any` типы в TypeScript | Быстрее писать | Баги в рантайме | Никогда для форм/данных |
| Отключение ESLint правил | Быстрый fix | Скрытые ошибки | Только для сторонних библиотек |
| Пропуск тестирования на mobile | Экономия времени | Сломано у 70% гостей | Никогда |

## Integration Gotchas

| Integration | Common Mistake | Correct Approach |
|-------------|----------------|------------------|
| EmailJS | Хардкод service/template ID в коде | Использовать env переменные, проверить лимиты |
| Yandex Maps iframe | Не указан `loading="lazy"` | Добавить lazy loading, задать фиксированную высоту |
| Google Fonts через link | Блокирует рендеринг | Использовать `next/font/google` |
| Vercel deploy | Не настроен `output: 'export'` для SSG | Добавить в `next.config.ts` если нужен static export |
| next/image + static export | Оптимизация не работает | Использовать `unoptimized: true` или предварительно сжать |

## Performance Traps

| Trap | Symptoms | Prevention | When It Breaks |
|------|----------|------------|----------------|
| Все фото загружаются сразу | Медленная начальная загрузка | Lazy loading + blur placeholder | > 5 фото без lazy loading |
| Карта загружается при открытии | +500ms к LCP | Lazy load iframe при intersection | Всегда — iframe тяжёлый |
| Framer Motion на каждом элементе | Рывки при скролле | Анимировать только секции, не каждый элемент | > 10 анимаций одновременно |
| Несжатые шрифты | +200-500ms к FCP | `next/font` с subset | Всегда для кастомных шрифтов |

## UX Pitfalls

| Pitfall | User Impact | Better Approach |
|---------|-------------|-----------------|
| Слишком много анимаций | Раздражение, тошнота у чувствительных | Умеренные fade-in, respect prefers-reduced-motion |
| Мелкий текст на мобильном | Не прочитать адрес/время | Минимум 16px, ключевая инфо — 18-20px |
| Нет индикации скролла | Гость думает, что это весь сайт | Стрелка вниз или анимация скролла в Hero |
| Автовоспроизведение музыки | Раздражение, гость в общественном месте | Кнопка Play, НЕ автостарт |
| Горизонтальный скролл | Сломанная верстка | Тестирование на 320px ширине, `overflow-x: hidden` |
| Форма RSVP без подтверждения | Гость не уверен, отправилось ли | Показать success state с анимацией |

## "Looks Done But Isn't" Checklist

- [ ] **OG-теги:** Протестированы в реальном Telegram и WhatsApp (не только в OpenGraph debugger)
- [ ] **RSVP:** Реальная отправка работает, не только UI формы
- [ ] **Изображения:** Протестированы на медленном соединении (Chrome DevTools → Slow 3G)
- [ ] **Обратный отсчёт:** Проверен в другом часовом поясе (изменить системное время)
- [ ] **Карта:** Работает в iOS Safari (частые проблемы с iframe)
- [ ] **Мобильная версия:** Протестирована на реальном устройстве, не только в DevTools
- [ ] **Шрифты:** Нет мерцания текста при загрузке
- [ ] **Scroll:** Нет горизонтального скролла на узких экранах (320px)
- [ ] **Favicon:** Установлен (не дефолтный Next.js)
- [ ] **404:** Страница не ломается при переходе по несуществующему пути

## Recovery Strategies

| Pitfall | Recovery Cost | Recovery Steps |
|---------|---------------|----------------|
| Тяжёлые изображения | LOW | Пережать через squoosh.app, заменить файлы |
| Карта не работает | LOW | Заменить на статичную картинку со ссылкой |
| RSVP лимиты | MEDIUM | Переключиться на Google Sheets или другой сервис |
| Тормозящие анимации | LOW | Уменьшить количество, упростить до fade-in |
| OG-теги не работают | LOW | Пересоздать meta, очистить кеш Telegram через @WebpageBot |
| FOUT шрифтов | LOW | Переключиться на `next/font` |
| Неправильный countdown | LOW | Исправить timezone в `constants.ts` |

## Pitfall-to-Phase Mapping

| Pitfall | Prevention Phase | Verification |
|---------|------------------|--------------|
| Тяжёлые изображения | Phase 1 (фундамент) | Lighthouse Performance > 90 |
| Карта не загружается | Phase 3 (интерактив) | Карта рендерится на мобильном |
| RSVP ломается | Phase 4 (RSVP) | 10+ тестовых отправок без ошибок |
| Анимации тормозят | Phase 2 (секции) | Smooth scroll на бюджетном Android |
| OG-теги не работают | Phase 5 (полировка) | Превью в Telegram показывает карточку |
| FOUT шрифтов | Phase 1 (фундамент) | Нет мерцания текста при загрузке |
| Неправильный countdown | Phase 2 (секции) | Одинаковое время в разных timezone |

## Sources

- Next.js 15 Documentation — Image Optimization, Metadata API, Fonts
- Framer Motion docs — Performance best practices
- Google Web Vitals — LCP, CLS, FID thresholds
- EmailJS documentation — Free tier limits
- Telegram Bot @WebpageBot — OG preview testing
- Chrome DevTools — Network throttling, Performance profiling
- Опыт референсных шаблонов (issues на GitHub)

---
*Pitfalls research for: wedding invitation website*
*Researched: 2026-02-22*
