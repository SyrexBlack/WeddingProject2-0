---
phase: 04-external-integrations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - .env.local.example
  - src/components/sections/MapSection.tsx
autonomous: true
requirements:
  - INTER-01

must_haves:
  truths:
    - "Yandex Maps iframe displays venue location with a pin marker"
    - "Route button opens Yandex Maps navigation in a new tab"
    - "Map section follows the same visual pattern as other sections (Container + SectionHeading + AnimatedSection)"
  artifacts:
    - path: "src/components/sections/MapSection.tsx"
      provides: "Map section with iframe and route button"
      min_lines: 30
    - path: ".env.local.example"
      provides: "Template for EmailJS environment variables"
      contains: "NEXT_PUBLIC_EMAILJS"
  key_links:
    - from: "src/components/sections/MapSection.tsx"
      to: "@/lib/constants"
      via: "import { mapData }"
      pattern: "import.*mapData.*constants"
    - from: "src/components/sections/MapSection.tsx"
      to: "@/components/ui/Container"
      via: "import { Container }"
      pattern: "import.*Container"

user_setup:
  - service: emailjs
    why: "RSVP form email delivery (prepared for Plan 02)"
    env_vars:
      - name: NEXT_PUBLIC_EMAILJS_SERVICE_ID
        source: "EmailJS Dashboard -> Email Services -> Service ID"
      - name: NEXT_PUBLIC_EMAILJS_TEMPLATE_ID
        source: "EmailJS Dashboard -> Email Templates -> Template ID"
      - name: NEXT_PUBLIC_EMAILJS_PUBLIC_KEY
        source: "EmailJS Dashboard -> Account -> Public Key"
    dashboard_config:
      - task: "Create free EmailJS account"
        location: "https://dashboard.emailjs.com/sign-up"
      - task: "Add email service (Gmail or other)"
        location: "EmailJS Dashboard -> Email Services -> Add New Service"
      - task: "Create RSVP email template with variables: from_name, status, plus_one, wishes"
        location: "EmailJS Dashboard -> Email Templates -> Create New Template"
---

<objective>
Install @emailjs/browser dependency, create environment variable template, and build the MapSection component with Yandex Maps iframe embed and route navigation button.

Purpose: Establish the external integration foundation (npm dep + env config) and deliver the simpler of the two integration sections (map), keeping the complex RSVP form for a dedicated plan.
Output: Working MapSection component rendering Yandex Maps iframe with route button.
</objective>

<execution_context>
@C:/Users/user/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-external-integrations/04-RESEARCH.md
@.planning/phases/04-external-integrations/04-CONTEXT.md
@src/lib/types.ts
@src/lib/constants.ts
@src/components/sections/InfoSection.tsx
@src/components/ui/Container.tsx
@src/components/ui/SectionHeading.tsx
@src/components/ui/AnimatedSection.tsx
@src/components/ui/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @emailjs/browser and create env template</name>
  <files>package.json, .env.local.example</files>
  <action>
1. Run `npm install --save @emailjs/browser` to add the EmailJS SDK dependency.

2. Create `.env.local.example` with the following content (template for user to copy to `.env.local`):
```
# EmailJS Configuration
# Get these values from https://dashboard.emailjs.com
NEXT_PUBLIC_EMAILJS_SERVICE_ID=your_service_id
NEXT_PUBLIC_EMAILJS_TEMPLATE_ID=your_template_id
NEXT_PUBLIC_EMAILJS_PUBLIC_KEY=your_public_key
```

3. Add `.env.local` to `.gitignore` if not already present (Next.js default .gitignore should already include it — verify).

This task prepares the external dependency and env config for both MapSection (this plan) and RSVPSection (next plan).
  </action>
  <verify>
- `npm ls @emailjs/browser` shows the package installed
- `.env.local.example` file exists with 3 NEXT_PUBLIC_EMAILJS_ variables
- `npm run build` still succeeds (no breaking changes from new dependency)
  </verify>
  <done>@emailjs/browser is in package.json dependencies, .env.local.example exists as a template for user configuration</done>
</task>

<task type="auto">
  <name>Task 2: Create MapSection component with Yandex Maps iframe</name>
  <files>src/components/sections/MapSection.tsx</files>
  <action>
Create `src/components/sections/MapSection.tsx` as a server component (no 'use client' — iframe is static HTML, route button is a plain `<a>` link).

**Structure (following InfoSection pattern):**
1. Import `mapData` from `@/lib/constants`
2. Import `Container`, `SectionHeading`, `AnimatedSection`, `Button` from UI components
3. Import `MapPin` from `lucide-react` for the route button icon

**Layout per CONTEXT.md decisions:**
- Wrapped in `<AnimatedSection id="map" className="py-16">`
- `<Container>` wrapping all content
- `<SectionHeading>Место проведения</SectionHeading>` (matches sectionOrder in constants.ts)
- Address text below heading: `<p className="text-center opacity-80 mt-2 mb-6">{mapData.address}</p>`
- Yandex Maps iframe in a container with `overflow-hidden rounded-card` for clipped corners:
  ```tsx
  <div className="overflow-hidden rounded-card">
    <iframe
      src={mapData.iframeSrc}
      width="100%"
      height="400"
      frameBorder="0"
      allowFullScreen
      title="Карта места проведения"
      className="block"
    />
  </div>
  ```
- Route button below map, centered:
  ```tsx
  <div className="mt-6 text-center">
    <Button href={mapData.navigationUrl} variant="outline">
      <MapPin size={18} className="mr-2" strokeWidth={1.5} />
      Построить маршрут
    </Button>
  </div>
  ```
  The Button component already renders as `<a>` when `href` is provided. Add `target="_blank"` and `rel="noopener noreferrer"` — but wait, Button doesn't forward these props. Instead, use a plain `<a>` tag styled to match, OR pass the href to Button and accept that it opens in the same tab (acceptable for navigation — Yandex Maps handles the redirect).

  Actually, looking at the Button component: it only passes `href` to `<a>`. It doesn't spread extra props like `target`. For the route button, since CONTEXT.md says "открывает в новой вкладке", we need `target="_blank"`. 
  
  **Solution:** Don't use the Button component for this. Create a styled `<a>` tag directly that matches the Button outline style, OR add a simple wrapper. Simplest: just use a styled anchor tag with the same Tailwind classes as Button outline:
  ```tsx
  <a
    href={mapData.navigationUrl}
    target="_blank"
    rel="noopener noreferrer"
    className="inline-flex items-center justify-center py-2 px-6 text-base rounded-card font-calmius border border-alexandrite text-alexandrite hover:bg-alexandrite hover:text-white transition-all duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-alexandrite/50 focus:ring-offset-2"
  >
    <MapPin size={18} className="mr-2" strokeWidth={1.5} />
    Построить маршрут
  </a>
  ```

**Export:** Named export `MapSection`.
  </action>
  <verify>
- File exists at `src/components/sections/MapSection.tsx`
- No TypeScript errors: `npx tsc --noEmit`
- Component imports mapData from constants and renders iframe + route button
- No 'use client' directive (server component)
  </verify>
  <done>MapSection renders Yandex Maps iframe with venue pin, address text, and "Построить маршрут" button opening navigation in new tab</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with no errors
- `npx tsc --noEmit` passes
- MapSection.tsx exists and exports MapSection
- @emailjs/browser appears in package.json dependencies
- .env.local.example exists with 3 EmailJS env var placeholders
</verification>

<success_criteria>
- Yandex Maps iframe URL from constants.ts rendered inside rounded container
- Route button links to navigationUrl from constants.ts with target="_blank"
- Section follows same visual pattern as InfoSection (AnimatedSection > Container > SectionHeading > content)
- @emailjs/browser installed for use in Plan 02
- Environment variable template ready for user configuration
</success_criteria>

<output>
After completion, create `.planning/phases/04-external-integrations/04-01-SUMMARY.md`
</output>
