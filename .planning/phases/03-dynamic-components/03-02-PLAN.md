---
phase: 03-dynamic-components
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src/components/ui/ParallaxSection.tsx
  - src/components/ui/AnimatedSection.tsx
  - src/components/sections/HeroSection.tsx
  - src/components/sections/CountdownSection.tsx
  - src/app/globals.css
autonomous: true
requirements:
  - INTER-05

must_haves:
  truths:
    - "Hero-секция имеет параллакс-эффект глубины — фон движется на ~50% медленнее контента при скролле"
    - "Countdown-секция имеет параллакс-эффект глубины аналогично Hero"
    - "Все анимации полностью отключены при prefers-reduced-motion: reduce — контент сразу видимый, без fade, parallax, stagger"
    - "Секции появляются с fade-up анимацией при скролле (существующий AnimatedSection продолжает работать)"
  artifacts:
    - path: "src/components/ui/ParallaxSection.tsx"
      provides: "Parallax wrapper using Framer Motion useScroll + useTransform"
      exports: ["ParallaxSection"]
    - path: "src/components/ui/AnimatedSection.tsx"
      provides: "Updated with useReducedMotion support — renders static when reduced motion preferred"
      exports: ["AnimatedSection"]
    - path: "src/components/sections/HeroSection.tsx"
      provides: "Hero section wrapped with parallax effect"
    - path: "src/components/sections/CountdownSection.tsx"
      provides: "Countdown section with parallax wrapper applied"
    - path: "src/app/globals.css"
      provides: "CSS reduced-motion media query for non-Framer Motion elements"
  key_links:
    - from: "src/components/sections/HeroSection.tsx"
      to: "src/components/ui/ParallaxSection.tsx"
      via: "ParallaxSection wrapping hero content"
      pattern: "ParallaxSection"
    - from: "src/components/sections/CountdownSection.tsx"
      to: "src/components/ui/ParallaxSection.tsx"
      via: "ParallaxSection wrapping countdown background"
      pattern: "ParallaxSection"
    - from: "src/components/ui/AnimatedSection.tsx"
      to: "framer-motion"
      via: "useReducedMotion hook"
      pattern: "useReducedMotion"
    - from: "src/components/ui/ParallaxSection.tsx"
      to: "framer-motion"
      via: "useScroll, useTransform, useReducedMotion"
      pattern: "useScroll.*useTransform"
---

<objective>
Добавить параллакс-эффект глубины на Hero и countdown секции, и полную поддержку prefers-reduced-motion для всех анимаций на сайте.

Purpose: Завершить визуальную часть Phase 3 — создать ощущение глубины при скролле и обеспечить доступность для пользователей, предпочитающих отсутствие анимаций.
Output: ParallaxSection component, обновлённые AnimatedSection/HeroSection/CountdownSection, CSS reduced-motion стили
</objective>

<execution_context>
@C:/Users/user/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dynamic-components/03-CONTEXT.md
@.planning/phases/03-dynamic-components/03-RESEARCH.md
@.planning/phases/03-dynamic-components/03-01-SUMMARY.md
@src/components/ui/AnimatedSection.tsx
@src/components/sections/HeroSection.tsx
@src/components/sections/CountdownSection.tsx
@src/app/globals.css
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ParallaxSection component and add reduced-motion support to AnimatedSection</name>
  <files>
    src/components/ui/ParallaxSection.tsx
    src/components/ui/AnimatedSection.tsx
    src/app/globals.css
  </files>
  <action>
    1. Create `src/components/ui/ParallaxSection.tsx`:
       - `'use client'` directive
       - Import: `useRef` from `react`, `motion`, `useScroll`, `useTransform`, `useReducedMotion` from `framer-motion`
       - Interface `ParallaxSectionProps`:
         - `children: ReactNode` — foreground content
         - `className?: string` — additional CSS classes on the outer wrapper
         - `speed?: number` — parallax intensity, default `0.5` (50% slower, per locked decision)
         - `id?: string` — section ID for navigation
       - Implementation:
         ```tsx
         const ref = useRef<HTMLDivElement>(null);
         const prefersReducedMotion = useReducedMotion();
         const { scrollYProgress } = useScroll({
           target: ref,
           offset: ["start end", "end start"]
         });
         // Map scroll progress to vertical offset.
         // At speed=0.5: background moves from -15% to 15% (30% total range) 
         // while content scrolls full distance — creates depth illusion.
         const yRange = 30 * speed; // percentage
         const y = useTransform(scrollYProgress, [0, 1], [`-${yRange}%`, `${yRange}%`]);
         ```
       - Render structure:
         ```tsx
         <div ref={ref} id={id} className={`relative overflow-hidden ${className}`}>
           {/* Parallax background layer — only animates if motion OK */}
           <motion.div
             className="absolute inset-0 -inset-y-[20%]"
             style={prefersReducedMotion ? {} : { y }}
           >
             {/* Background visual — gradient or subtle pattern */}
             <div className="absolute inset-0 bg-gradient-to-b from-alexandrite-light/30 via-transparent to-alexandrite-light/20" />
           </motion.div>
           {/* Foreground content — always static position */}
           <div className="relative z-10">
             {children}
           </div>
         </div>
         ```
       - If `prefersReducedMotion` is true, the background `style` is empty object — no transform applied, background stays static.
       - The `-inset-y-[20%]` on the parallax layer ensures the background extends beyond the visible area to prevent gaps during parallax movement.

    2. Update `src/components/ui/AnimatedSection.tsx`:
       - Add import: `useReducedMotion` from `framer-motion`
       - Inside the component, call `const prefersReducedMotion = useReducedMotion();`
       - When `prefersReducedMotion` is true:
         - Render a plain `<div>` instead of `<motion.div>` with the same `id`, `className`, and `children`
         - No animation props whatsoever — content immediately visible
       - When false: keep existing behavior exactly as-is (fade-up, duration 0.9, viewport.once: false, amount: 0.15)
       - This satisfies the CONTEXT.md locked decision: "prefers-reduced-motion — полностью отключить все анимации"

    3. Update `src/app/globals.css`:
       - Add a `@media (prefers-reduced-motion: reduce)` block at the end:
         ```css
         @media (prefers-reduced-motion: reduce) {
           /* Disable all CSS transitions and animations */
           *, *::before, *::after {
             animation-duration: 0.01ms !important;
             animation-iteration-count: 1 !important;
             transition-duration: 0.01ms !important;
             scroll-behavior: auto !important;
           }
         }
         ```
       - This catches any CSS-based animations that aren't controlled by Framer Motion (e.g., scroll-behavior on html).
  </action>
  <verify>
    - `npx tsc --noEmit` passes without new errors
    - ParallaxSection.tsx exports a named `ParallaxSection` component
    - AnimatedSection.tsx still exports `AnimatedSection` with same interface
    - globals.css has the reduced-motion media query
    - In Chrome DevTools → Rendering → "Emulate CSS media feature prefers-reduced-motion: reduce" → AnimatedSection renders plain div (verify via React DevTools or inspect element — no motion.div)
  </verify>
  <done>
    ParallaxSection component creates parallax depth effect via useScroll/useTransform. AnimatedSection respects prefers-reduced-motion by rendering static div. globals.css disables CSS animations for reduced-motion users.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply parallax to Hero and Countdown sections, update countdown reduced-motion support</name>
  <files>
    src/components/sections/HeroSection.tsx
    src/components/sections/CountdownSection.tsx
  </files>
  <action>
    1. Update `src/components/sections/HeroSection.tsx`:
       - Add `'use client'` directive (needed for ParallaxSection which is a client component)
       - Import `ParallaxSection` from `@/components/ui/ParallaxSection`
       - Wrap the entire `<section>` content with `<ParallaxSection id="hero" className="h-screen" speed={0.5}>`:
         ```tsx
         export function HeroSection() {
           return (
             <ParallaxSection id="hero" className="h-screen bg-chocolate/5" speed={0.5}>
               <div className="h-full flex items-center justify-center">
                 {/* Existing glassmorphism overlay — unchanged */}
                 <div className="backdrop-blur-md bg-white/30 rounded-2xl p-8 sm:p-12 shadow-lg border border-white/20 text-center max-w-lg mx-4">
                   <h1 className="text-5xl sm:text-7xl font-calmius text-chocolate">
                     {heroData.coupleNames}
                   </h1>
                   <p className="text-lg sm:text-xl opacity-80 mt-4">
                     {heroData.invitationPhrase}
                   </p>
                   <p className="text-xl sm:text-2xl mt-6 text-alexandrite font-medium">
                     {heroData.date}
                   </p>
                 </div>
               </div>
             </ParallaxSection>
           );
         }
         ```
       - The ParallaxSection handles the `id="hero"`, `overflow-hidden`, and parallax background layer.
       - The glassmorphism overlay content sits in the foreground (z-10) and scrolls normally.
       - `speed={0.5}` per locked decision: ~50% slower background.

    2. Update `src/components/sections/CountdownSection.tsx`:
       - Import `ParallaxSection` from `@/components/ui/ParallaxSection`
       - Import `useReducedMotion` from `framer-motion`
       - Wrap the `<section>` with `<ParallaxSection>` for parallax effect:
         ```tsx
         <ParallaxSection id="countdown" className="py-16" speed={0.5}>
           <Container>
             <SectionHeading>До нашего дня</SectionHeading>
             {/* countdown content */}
           </Container>
         </ParallaxSection>
         ```
       - Add reduced-motion support to countdown-specific animations:
         - Call `const prefersReducedMotion = useReducedMotion();`
         - If `prefersReducedMotion`:
           - Stagger container: render plain `<div>` instead of `<motion.div>` with variants
           - Card entrance: render plain `<div>` instead of `<motion.div>` with cardVariants
           - Digit AnimatePresence: render plain `<span>` with the number, no AnimatePresence/motion.span wrapping
         - Else: keep all animations (stagger, fade, AnimatePresence)
       - This ensures ALL animations are disabled per the locked CONTEXT.md decision, not just the parallax
  </action>
  <verify>
    - `npm run build` completes without errors
    - `npm run dev` → visit http://localhost:3000:
      1. Scroll past Hero → observe background moving slower than content (parallax depth)
      2. Scroll to countdown → observe parallax depth on countdown section background
      3. Countdown cards still animate with stagger on first view
      4. Seconds digit still fades on each tick
    - Chrome DevTools → Rendering → "Emulate prefers-reduced-motion: reduce":
      1. Hero section visible immediately (no parallax movement)
      2. Countdown cards visible immediately (no stagger, no fade)
      3. Seconds update without fade animation
      4. All sections visible without fade-up (AnimatedSection renders static)
    - No console errors, no hydration warnings
    - Mobile viewport (375px) still looks correct with parallax
  </verify>
  <done>
    Hero and Countdown sections have parallax depth effect (~50% slower background). All animations (parallax, stagger, digit fade, section fade-up) completely disabled when prefers-reduced-motion is set. Content immediately visible for reduced-motion users.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds without errors
- Parallax visible on Hero section when scrolling — background moves noticeably slower than foreground
- Parallax visible on Countdown section similarly
- AnimatedSection still triggers fade-up on scroll for all other sections
- prefers-reduced-motion: reduce disables ALL animations site-wide:
  - No section fade-up
  - No parallax movement
  - No countdown stagger
  - No digit fade
  - Content immediately visible
- No performance issues (jank/stutter) during parallax on mobile viewport
</verification>

<success_criteria>
1. ParallaxSection component wraps Hero and Countdown with depth parallax (~50% background speed)
2. AnimatedSection renders plain div when prefers-reduced-motion is set — zero animation
3. CountdownSection animations (stagger, digit fade) disabled for reduced-motion users
4. CSS fallback in globals.css disables any remaining CSS-based animations
5. All existing section animations (fade-up) continue to work normally without reduced-motion
6. No hydration errors, no console warnings, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-dynamic-components/03-02-SUMMARY.md`
</output>
