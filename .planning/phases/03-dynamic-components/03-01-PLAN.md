---
phase: 03-dynamic-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useCountdown.ts
  - src/lib/pluralize.ts
  - src/components/sections/CountdownSection.tsx
  - src/app/page.tsx
autonomous: true
requirements:
  - CONT-02

must_haves:
  truths:
    - "Countdown показывает дни, часы, минуты и секунды, обновляясь каждую секунду в реальном времени"
    - "Русские подписи корректно склоняются (1 день, 2 дня, 5 дней; 1 час, 2 часа, 5 часов)"
    - "После наступления даты свадьбы вместо карточек показывается праздничное сообщение"
    - "Карточки countdown появляются с stagger-эффектом (по очереди: дни → часы → минуты → секунды)"
    - "Смена цифр сопровождается плавной fade-анимацией"
  artifacts:
    - path: "src/hooks/useCountdown.ts"
      provides: "Timer logic hook returning days/hours/minutes/seconds/isExpired"
      exports: ["useCountdown"]
    - path: "src/lib/pluralize.ts"
      provides: "Russian pluralization utility for time units"
      exports: ["pluralize"]
    - path: "src/components/sections/CountdownSection.tsx"
      provides: "Countdown section with card-based UI"
      exports: ["CountdownSection"]
    - path: "src/app/page.tsx"
      provides: "Main page with real CountdownSection replacing placeholder"
  key_links:
    - from: "src/components/sections/CountdownSection.tsx"
      to: "src/hooks/useCountdown.ts"
      via: "useCountdown() hook call"
      pattern: "useCountdown"
    - from: "src/components/sections/CountdownSection.tsx"
      to: "src/lib/constants.ts"
      via: "import countdownData"
      pattern: "import.*countdownData.*from.*constants"
    - from: "src/components/sections/CountdownSection.tsx"
      to: "src/lib/pluralize.ts"
      via: "pluralize() for Russian labels"
      pattern: "pluralize"
    - from: "src/hooks/useCountdown.ts"
      to: "date-fns"
      via: "differenceInSeconds for time calculation"
      pattern: "differenceInSeconds"
    - from: "src/app/page.tsx"
      to: "src/components/sections/CountdownSection.tsx"
      via: "import and render CountdownSection"
      pattern: "CountdownSection"
---

<objective>
Создать работающий countdown-таймер обратного отсчёта до свадьбы с карточками, русскими подписями и анимациями.

Purpose: Реализовать ключевой интерактивный компонент Phase 3 — обратный отсчёт, показывающий гостям сколько осталось до торжества.
Output: CountdownSection component, useCountdown hook, pluralize utility, обновлённый page.tsx
</objective>

<execution_context>
@C:/Users/user/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dynamic-components/03-CONTEXT.md
@.planning/phases/03-dynamic-components/03-RESEARCH.md
@src/lib/types.ts
@src/lib/constants.ts
@src/components/ui/Card.tsx
@src/components/ui/AnimatedSection.tsx
@src/app/page.tsx
@package.json
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install date-fns, create useCountdown hook and pluralize utility</name>
  <files>
    src/hooks/useCountdown.ts
    src/lib/pluralize.ts
    package.json
  </files>
  <action>
    1. Install date-fns: `npm install date-fns`

    2. Create `src/lib/pluralize.ts`:
       - Export function `pluralize(n: number, one: string, few: string, many: string): string`
       - Russian pluralization rules:
         - n % 10 === 1 && n % 100 !== 11 → one (1 день)
         - n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) → few (2 дня)
         - else → many (5 дней)
       - Returns the correct form (does NOT prepend the number — caller handles display)

    3. Create `src/hooks/useCountdown.ts`:
       - `'use client'` directive at top
       - Import `differenceInSeconds` from `date-fns`
       - Export `useCountdown(targetDate: string)` hook
       - State: `{ days: number, hours: number, minutes: number, seconds: number, isExpired: boolean }`
       - On mount (useEffect):
         - Parse targetDate with `new Date(targetDate)` — the ISO string with +03:00 offset is handled natively
         - Calculate `totalSeconds = differenceInSeconds(target, new Date())`
         - If totalSeconds <= 0 → set isExpired: true, all values to 0
         - Else compute: days = Math.floor(totalSeconds / 86400), hours = Math.floor((totalSeconds % 86400) / 3600), minutes = Math.floor((totalSeconds % 3600) / 60), seconds = totalSeconds % 60
         - Set up `setInterval(1000)` to recalculate every second
         - Return cleanup: `clearInterval`
       - To avoid SSR hydration mismatch: initialize state with `{ days: 0, hours: 0, minutes: 0, seconds: 0, isExpired: false }` and only start calculating in useEffect (client-side only). Add `isHydrated` boolean state that flips to true after first effect.
       - Return `{ days, hours, minutes, seconds, isExpired, isHydrated }`
  </action>
  <verify>
    - `npm ls date-fns` shows date-fns installed
    - TypeScript compiles: `npx tsc --noEmit` passes (or no new errors)
    - pluralize(1, 'день', 'дня', 'дней') === 'день'
    - pluralize(2, 'день', 'дня', 'дней') === 'дня'
    - pluralize(5, 'день', 'дня', 'дней') === 'дней'
    - pluralize(21, 'день', 'дня', 'дней') === 'день'
    - pluralize(11, 'день', 'дня', 'дней') === 'дней'
  </verify>
  <done>
    useCountdown hook returns { days, hours, minutes, seconds, isExpired, isHydrated } and updates every second. pluralize correctly handles all Russian declension cases for time units. date-fns is installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CountdownSection component and integrate into page.tsx</name>
  <files>
    src/components/sections/CountdownSection.tsx
    src/app/page.tsx
  </files>
  <action>
    1. Create `src/components/sections/CountdownSection.tsx`:
       - `'use client'` directive (uses hooks, Framer Motion, browser APIs)
       - Import: `useCountdown` from `@/hooks/useCountdown`, `pluralize` from `@/lib/pluralize`, `countdownData` from `@/lib/constants`, `SectionHeading` from `@/components/ui/SectionHeading`, `Container` from `@/components/ui/Container`, `motion`, `AnimatePresence` from `framer-motion`
       - **DO NOT import Card component** — use custom card styling inline for more control over the countdown-specific design. Cards need number-specific sizing and alexandrite accents that differ from the generic Card.

       - **Component structure:**
         ```
         <section id="countdown" className="py-16">
           <Container>
             <SectionHeading>До нашего дня</SectionHeading>  {/* Per locked decision */}
             {isExpired ? <ExpiredMessage /> : <CountdownCards />}
           </Container>
         </section>
         ```

       - **CountdownCards (inline or sub-component):**
         - Parent `motion.div` with flex layout, gap, center alignment
         - Use stagger via parent variants:
           ```
           const containerVariants = {
             hidden: {},
             visible: { transition: { staggerChildren: 0.15 } }
           };
           const cardVariants = {
             hidden: { opacity: 0, y: 20 },
             visible: { opacity: 1, y: 0, transition: { duration: 0.6, ease: 'easeOut' } }
           };
           ```
         - Parent: `<motion.div variants={containerVariants} initial="hidden" whileInView="visible" viewport={{ once: true, amount: 0.3 }}>`
           NOTE: stagger uses `once: true` because it's the entrance effect — subsequent scroll triggers should NOT re-stagger. The individual digit fade handles ongoing animation.

       - **Each countdown card (4 total: days, hours, minutes, seconds):**
         - `<motion.div variants={cardVariants}>` for stagger child
         - Styling: `bg-white/80 rounded-card shadow-sm p-6` (matching Card component style) + `border border-alexandrite-light` for accent
         - Large number display: `<div className="text-4xl sm:text-5xl font-calmius text-alexandrite font-semibold">` 
         - Number with AnimatePresence for fade transition:
           ```tsx
           <AnimatePresence mode="wait">
             <motion.span
               key={value}
               initial={{ opacity: 0, y: -10 }}
               animate={{ opacity: 1, y: 0 }}
               exit={{ opacity: 0, y: 10 }}
               transition={{ duration: 0.3, ease: 'easeInOut' }}
             >
               {value}
             </motion.span>
           </AnimatePresence>
           ```
         - Label below number: `<span className="text-sm text-chocolate/60 mt-1">` with pluralized text
         - Labels: pluralize(days, 'день', 'дня', 'дней'), pluralize(hours, 'час', 'часа', 'часов'), pluralize(minutes, 'минута', 'минуты', 'минут'), pluralize(seconds, 'секунда', 'секунды', 'секунд')

       - **Expired state:**
         - Show `countdownData.expiredMessage` in elegant typography
         - Use `motion.div` with fade-in animation
         - Festive feel: alexandrite color text, larger font

       - **Hydration handling:**
         - Before `isHydrated` is true, show the same card layout but with "—" or "0" values (no flicker)
         - Add `suppressHydrationWarning` on the number spans as extra safety

       - **Responsive layout:**
         - Desktop: 4 cards in a row (flex, gap-4 or gap-6)
         - Mobile: 2x2 grid (grid grid-cols-2 gap-3 sm:flex sm:gap-6)

    2. Update `src/app/page.tsx`:
       - Import `CountdownSection` from `@/components/sections/CountdownSection`
       - Replace the countdown placeholder block (lines 22-28, the AnimatedSection with "Countdown будет реализован в Phase 3") with `<CountdownSection />`
       - Keep all other sections exactly as they are
       - Remove unused imports if any (Container might still be needed by RSVP/Map placeholders — check before removing)
  </action>
  <verify>
    - `npm run build` completes without errors
    - `npm run dev` → visit http://localhost:3000 → countdown section visible with 4 number cards
    - Numbers update every second (seconds card changes)
    - Labels in Russian with correct pluralization
    - Cards appear with stagger animation when scrolling into view
    - Digit changes have subtle fade animation
    - On mobile viewport (Chrome DevTools → responsive → 375px): cards in 2x2 grid
    - No hydration warnings in browser console
  </verify>
  <done>
    CountdownSection renders 4 animated cards showing days/hours/minutes/seconds until wedding. Russian labels correctly pluralized. Stagger entrance animation on first view. Fade transition on digit changes. Placeholder in page.tsx replaced with real component. Expired state shows festive message.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds without errors
- Countdown displays correct time remaining until 2026-08-15T15:00:00+03:00
- Seconds update in real-time (every second)
- Russian pluralization correct for edge cases (1, 2, 5, 11, 21, 22)
- Stagger entrance animation triggers on scroll into view
- Digit fade animation visible on second changes
- No console errors or hydration mismatches
</verification>

<success_criteria>
1. CountdownSection component renders 4 cards (days, hours, minutes, seconds) with live countdown to wedding date
2. Russian time labels correctly pluralized (1 день, 2 дня, 5 дней, 11 дней, 21 день)
3. Cards appear with stagger animation (sequential: days → hours → minutes → seconds)
4. Digit transitions have smooth fade animation via AnimatePresence
5. Expired state replaces cards with festive message from countdownData.expiredMessage
6. No SSR hydration mismatches — client-only timer initialization
7. Responsive: 2x2 grid on mobile, 4 in a row on desktop
</success_criteria>

<output>
After completion, create `.planning/phases/03-dynamic-components/03-01-SUMMARY.md`
</output>
