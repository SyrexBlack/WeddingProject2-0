---
phase: 05-polish-deploy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/og/route.tsx
  - src/app/layout.tsx
  - public/images/hero-desktop.jpg
  - public/images/hero-mobile.jpg
  - src/components/sections/HeroSection.tsx
  - src/lib/types.ts
  - next.config.ts
autonomous: true
requirements:
  - DEPLOY-01
  - DEPLOY-02

must_haves:
  truths:
    - "OG-изображение генерируется динамически через /api/og с градиентом из свадебной палитры"
    - "layout.tsx содержит полные OG-метатеги: title, description, image URL, locale ru_RU, twitter:card"
    - "HeroSection отображает фоновое фото через next/image с blur placeholder"
    - "Два Hero-фото: landscape для десктопа, portrait для мобилки через responsive srcSet"
  artifacts:
    - path: "src/app/api/og/route.tsx"
      provides: "Dynamic OG image generation via next/og ImageResponse"
      contains: "ImageResponse"
    - path: "src/app/layout.tsx"
      provides: "Complete OG metadata with image URL"
      contains: "openGraph"
    - path: "public/images/hero-desktop.jpg"
      provides: "Placeholder landscape hero photo for desktop"
    - path: "public/images/hero-mobile.jpg"
      provides: "Placeholder portrait hero photo for mobile"
    - path: "src/components/sections/HeroSection.tsx"
      provides: "Hero with next/image and blur placeholder"
      contains: "next/image"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/app/api/og/route.tsx"
      via: "OG image URL pointing to /api/og"
      pattern: "/api/og"
    - from: "src/components/sections/HeroSection.tsx"
      to: "public/images/hero-desktop.jpg"
      via: "next/image static import for blur placeholder"
      pattern: "import.*hero"
---

<objective>
Configure Open Graph meta tags with dynamic OG image generation and optimize Hero section with next/image.

Purpose: Enable rich link previews in Telegram/WhatsApp (DEPLOY-01) and optimize all images through next/image pipeline (DEPLOY-02).
Output: Dynamic OG image route, complete metadata in layout.tsx, Hero section with optimized images and blur placeholders.
</objective>

<execution_context>
@C:/Users/user/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/app/layout.tsx
@src/components/sections/HeroSection.tsx
@src/lib/constants.ts
@src/lib/types.ts
@next.config.ts
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dynamic OG image route and update layout.tsx metadata</name>
  <files>src/app/api/og/route.tsx, src/app/layout.tsx</files>
  <action>
**1. Create `src/app/api/og/route.tsx`:**

Create an Edge route using `next/og` (ImageResponse) that renders a 1200×630 OG image card:
- Import `ImageResponse` from `next/og`
- Export `GET` handler with `runtime = 'edge'`
- Render a div styled with inline CSS (JSX, no Tailwind — OG Image API only supports inline styles):
  - Background: linear gradient using wedding palette colors — `#598c74` (александрит) → `#D4C5A9` (шампань) → `#E8D5C4` (пудровый)
  - Centered white text content:
    - Names: «Анна & Михаил» in large serif font (48-64px)
    - Subtitle: «Приглашение на свадьбу» (24-28px)
    - Date + venue: «15 августа 2026 · Усадьба «Архангельское»» (20-24px)
  - White semi-transparent border frame inset ~20px from edges (decorative)
  - All text white for contrast on gradient background
- Font: Use system serif as fallback (Cormorant Garamond can't be easily loaded in Edge OG). Alternatively, fetch the Google Fonts Cormorant Garamond 300 TTF via fetch() and pass to ImageResponse fonts option — but only if straightforward. If complex, use system serif.
- Size: `{ width: 1200, height: 630 }`

**2. Update `src/app/layout.tsx` metadata:**

Update the `metadata` export to include complete OG tags per user decisions:
- `title`: 'Анна & Михаил — Приглашение на свадьбу'
- `description`: '15 августа 2026 · Усадьба «Архангельское»'
- `openGraph.title`: 'Анна & Михаил — Приглашение на свадьбу'
- `openGraph.description`: '15 августа 2026 · Усадьба «Архангельское»'
- `openGraph.type`: 'website'
- `openGraph.locale`: 'ru_RU' (already present)
- `openGraph.images`: `[{ url: '/api/og', width: 1200, height: 630, alt: 'Анна & Михаил — Приглашение на свадьбу' }]`
- Add `twitter` metadata: `{ card: 'summary_large_image', title: same, description: same, images: ['/api/og'] }` — per Claude's discretion, `summary_large_image` for visual wedding site
- Keep `lang="ru"` and existing structure

Note: The OG image URL uses relative path `/api/og`. Next.js resolves this to the full URL based on `metadataBase`. Add `metadataBase: new URL('https://wedding-project2-0.vercel.app')` — this will be updated after deploy with actual URL. For now it provides correct absolute URL generation.
  </action>
  <verify>
Run `npm run build` — no TypeScript errors. Check that `src/app/api/og/route.tsx` compiles. After `npm run dev`, visit `http://localhost:3000/api/og` in browser — should return a PNG image with gradient background and wedding text.
  </verify>
  <done>
OG image route returns a 1200×630 PNG with wedding palette gradient, names, date, and venue. Layout.tsx has complete openGraph + twitter metadata pointing to /api/og.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Hero placeholder images and optimize HeroSection with next/image</name>
  <files>public/images/hero-desktop.jpg, public/images/hero-mobile.jpg, src/components/sections/HeroSection.tsx, next.config.ts</files>
  <action>
**1. Create `public/images/` directory and download placeholder photos:**

Download two Unsplash placeholder photos (free license) using curl/fetch:
- Desktop (landscape ~1920×1080): A soft, elegant wedding-themed photo. Use a direct Unsplash URL like `https://images.unsplash.com/photo-1519741497674-611481863552?w=1920&q=80` (wedding couple soft focus) or similar romantic/floral image. Save as `public/images/hero-desktop.jpg`
- Mobile (portrait ~750×1334): Same or similar photo cropped for portrait. Use `https://images.unsplash.com/photo-1519741497674-611481863552?w=750&h=1334&fit=crop&q=80` or a separate portrait-oriented wedding photo. Save as `public/images/hero-mobile.jpg`

If curl download doesn't work (CORS, etc.), create minimal placeholder JPGs using a different approach — e.g., use Node.js to create simple gradient JPEGs, or download from a direct CDN. The key is having actual JPG files so `next/image` with `placeholder="blur"` works via static import.

**2. Update `src/components/sections/HeroSection.tsx`:**

Transform HeroSection to use `next/image` with blur placeholders:
- Add static imports at top: `import heroDesktop from '../../../public/images/hero-desktop.jpg'` and `import heroMobile from '../../../public/images/hero-mobile.jpg'` (static imports enable automatic blur placeholder generation)
- Replace the `bg-chocolate/5` background with actual hero images using `next/image`:
  - Use `<Image>` from `next/image` with `fill`, `priority` (hero is above fold), `sizes`, `quality={85}`
  - Desktop image: `className="hidden md:block object-cover"` with `placeholder="blur"`
  - Mobile image: `className="md:hidden object-cover"` with `placeholder="blur"`
  - Both should have `fill` and sit behind the glassmorphism overlay (use absolute positioning, z-index layering)
- Keep ParallaxSection wrapper and glassmorphism overlay intact
- The container div needs `position: relative` and the images need `position: absolute` with `inset: 0` (which `fill` provides)
- Add `priority` prop to both images (LCP element, above fold)
- Apply `sizes="100vw"` since hero is full-width

Per user decision: Two separate files for desktop/mobile for optimal cropping. Static import for automatic `placeholder="blur"`.

**4. Apply 320px-responsive text sizes to HeroSection (coordinated with Plan 02):**
Per user decision: шрифты — два фиксированных размера через Tailwind breakpoints (`text-2xl md:text-5xl`).
- Change `h1` from `text-5xl sm:text-7xl` → `text-2xl md:text-5xl`
- Change invitation phrase from `text-lg sm:text-xl` → `text-base md:text-xl`
- Change date from `text-xl sm:text-2xl` → `text-lg md:text-2xl`
- Reduce glassmorphism container padding from `p-8 sm:p-12` → `p-5 md:p-12`

**3. Update `next.config.ts` if needed:**

If images are from external domains (Unsplash), no config needed since they're local files in `public/`. Verify current config is sufficient for local images with `next/image`. No changes needed for local images — `next/image` handles `public/` images natively.

Per user decision: JPG исходник, Next.js автоматически конвертирует в WebP. This happens automatically with next/image — no config needed.
  </action>
  <verify>
Run `npm run dev`, visit `http://localhost:3000` — Hero section displays a photo background with blur placeholder on initial load, then sharp image. Verify both desktop and mobile variants render (resize browser). Check `<img>` elements in DevTools have `srcset` with WebP variants. Run `npm run build` — no errors.
  </verify>
  <done>
Hero section shows placeholder photos via next/image with automatic blur placeholders, lazy loading disabled (priority for LCP), and automatic WebP conversion. Desktop shows landscape, mobile shows portrait image.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. `/api/og` returns a valid PNG image (1200×630) with gradient and text
3. Page source contains OG meta tags with correct title, description, image URL
4. Hero section displays photo backgrounds with blur-up loading effect
5. DevTools Network tab shows WebP image delivery for hero photos
</verification>

<success_criteria>
- OG image route generates dynamic wedding card with palette gradient, names, date, venue
- Layout metadata includes openGraph + twitter with image reference
- Hero displays optimized photos through next/image with blur placeholders
- Two hero variants: landscape (desktop) and portrait (mobile)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish-deploy/05-01-SUMMARY.md`
</output>
